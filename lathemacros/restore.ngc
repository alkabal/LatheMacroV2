; restore metric/inch absolute/relative, feed as per paramter values
; call as o<restore> call     ; restore g20/21, g90/g91, feedrate cuter-comp and other using now global _backup_var
;
o<restore> sub

;ajout pour remplacer le reset state lathe completement mais TODO a convertir en _backup_var
G64P0.001 G80 G92.1 G94 G97 G99 M5 M9 M53 M48

o100 if [#<_backup_metric> NE #<_metric>]
 o101    if [#<_backup_metric>]
         G21
 o101    else
         G20
 o101    endif
o100 endif


o200 if [#<_backup_absolute> NE #<_absolute>]
 o201    if [#<_backup_absolute>]
        G90
 o201    else
        G91
 o201    endif
o200 endif


o300 if [#<_backup_feed> NE #<_feed>]
     F[#<_backup_feed>]
o300 endif


o400 if [#<_backup_ccomp> NE #<_ccomp>]
 o401  if [#<_backup_ccomp> EQ 400]
       G40
 o401  endif
 o402  if [#<_backup_ccomp> EQ 410]
       G41
 o402  endif
 o403  if [#<_backup_ccomp> EQ 411]
       G41.1
 o403  endif
 o404  if [#<_backup_ccomp> EQ 420]
       G42
 o404  endif
 o405  if [#<_backup_ccomp> EQ 421]
       G42.1
 o405  endif
o400 endif


o500 if [#<_backup_tool_offset> NE #<_tool_offset>]
 o501  if [#<_backup_tool_offset> EQ 490]
       G49
 o501  endif
 o502  if [#<_backup_tool_offset> EQ 430]
       G43
 o502  endif
 o503  if [#<_backup_tool_offset> EQ 431]
       G43.1
 o503  endif
 o504  if [#<_backup_tool_offset> EQ 432]
       G43.2
 o504  endif
o500 endif


o600 if [#<_backup_coord_system> NE #<_coord_system>]
 o601  if [#<_backup_coord_system> EQ 540]
       G54
 o601  endif
 o602  if [#<_backup_coord_system> EQ 550]
       G55
 o602  endif
 o603  if [#<_backup_coord_system> EQ 560]
       G56
 o603  endif
 o604  if [#<_backup_coord_system> EQ 570]
       G57
 o604  endif
 o605  if [#<_backup_coord_system> EQ 580]
       G58
 o605  endif
 o606  if [#<_backup_coord_system> EQ 590]
       G59
 o606  endif
 o607  if [#<_backup_coord_system> EQ 591]
       G59.1
 o607  endif
 o608  if [#<_backup_coord_system> EQ 592]
       G59.2
 o608  endif
 o609  if [#<_backup_coord_system> EQ 593]
       G59.3
 o609  endif
o600 endif


o700 if [#<_backup_ijk_abs_mode> NE #<_ijk_absolute_mode>]
     o701    if [#<_backup_ijk_abs_mode>]
             G90.1
     o701    else
             G91.1
     o701    endif
o700 endif

o800 if [#<_backup_lathe_mode>}
     o801 if [#<_backup_lathe_diam_mode> NE #<_lathe_diameter_mode>]
          o802    if [#<_backup_lathe_diam_mode>]
                  G7  (lathe diameter mode)
          o802    else
                  G8
          o802    endif
          G18 (select lathe XZ plane)
     o801 endif
o800 else
     G17 (select mill XY plane)
o800 endif

o<restore> endsub
M2
